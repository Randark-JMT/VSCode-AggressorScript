{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "AggressorScript",
  "scopeName": "source.cna",
  "fileTypes": ["cna"],
  "patterns": [
    { "include": "#comment" },
    { "include": "#strings" },
    { "include": "#heredoc" },
    { "include": "#numeric" },
    { "include": "#keywords" },
    { "include": "#constants" },
    { "include": "#function-definition" },
    { "include": "#event-handler" },
    { "include": "#builtin-beacon-commands" },
    { "include": "#builtin-beacon-info" },
    { "include": "#builtin-aggressor-functions" },
    { "include": "#builtin-sleep-functions" },
    { "include": "#builtin-hooks" },
    { "include": "#function-call" },
    { "include": "#variable" },
    { "include": "#operators" }
  ],
  "repository": {
    "comment": {
      "patterns": [
        {
          "name": "comment.line.hash.cna",
          "begin": "#",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.comment.cna" }
          },
          "end": "$"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.cna",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "name": "constant.character.escape.cna", "match": "\\\\." },
            {
              "name": "variable.other.interpolated.cna",
              "match": "(\\$|@|%)[a-zA-Z_][a-zA-Z0-9_]*"
            }
          ]
        },
        {
          "name": "string.quoted.single.cna",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "name": "constant.character.escape.cna", "match": "\\\\." }
          ]
        }
      ]
    },
    "heredoc": {
      "patterns": [
        {
          "name": "string.unquoted.heredoc.cna",
          "begin": "<<-?'?(\\w+)'?",
          "beginCaptures": {
            "1": { "name": "keyword.control.heredoc-token.cna" }
          },
          "end": "^\\s*\\1\\s*$",
          "endCaptures": {
            "0": { "name": "keyword.control.heredoc-token.cna" }
          }
        }
      ]
    },
    "numeric": {
      "patterns": [
        {
          "name": "constant.numeric.integer.hexadecimal.cna",
          "match": "(?<![\\w\\d.])0[xX][0-9A-Fa-f]+"
        },
        {
          "name": "constant.numeric.float.cna",
          "match": "(?<![\\w\\d.])\\d+\\.\\d+([eE][+-]?\\d+)?"
        },
        {
          "name": "constant.numeric.integer.cna",
          "match": "(?<![\\w\\d.])\\d+"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.cna",
          "match": "\\b(if|else if|else|while|for|foreach|return|break|continue|halt)\\b"
        },
        {
          "name": "keyword.control.exception.cna",
          "match": "\\b(try|catch|throw)\\b"
        },
        {
          "name": "keyword.other.cna",
          "match": "\\b(local|global|this|import|include|use)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.boolean.cna",
          "match": "\\b(true|false)\\b"
        },
        {
          "name": "constant.language.null.cna",
          "match": "\\b(\\$null|\\$NIL)\\b"
        },
        {
          "name": "constant.language.cna",
          "match": "\\$[0-9]\\b"
        },
        {
          "name": "constant.language.args.cna",
          "match": "\\b(@_)\\b"
        }
      ]
    },
    "function-definition": {
      "patterns": [
        {
          "name": "meta.function.cna",
          "match": "\\b(sub|alias|command|popup)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.declaration.function.cna" },
            "2": { "name": "entity.name.function.cna" }
          }
        },
        {
          "name": "meta.function.item.cna",
          "match": "\\b(item)\\s+(\"[^\"]*\"|'[^']*')",
          "captures": {
            "1": { "name": "keyword.declaration.function.cna" },
            "2": { "name": "entity.name.function.cna" }
          }
        }
      ]
    },
    "event-handler": {
      "patterns": [
        {
          "name": "meta.event-handler.cna",
          "match": "\\b(on)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.declaration.event.cna" },
            "2": { "name": "entity.name.type.event.cna" }
          }
        },
        {
          "name": "meta.hook.cna",
          "match": "\\b(set)\\s+([A-Z_][A-Z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.declaration.hook.cna" },
            "2": { "name": "entity.name.type.hook.cna" }
          }
        }
      ]
    },
    "builtin-beacon-commands": {
      "comment": "b* functions that send tasks to Beacon",
      "patterns": [
        {
          "name": "support.function.beacon-command.cna",
          "match": "(?<![\\w&])&?(barch|bargue_add|bargue_list|bargue_remove|bblockdlls|bbrowser|bbrowserpivot|bbrowserpivot_stop|bbypassuac|bcancel|bcd|bcheckin|bclear|bconnect|bcovertvpn|bcp|bdata|bdcsync|bdesktop|bdllinject|bdllload|bdllspawn|bdownload|bdrives|belevate|belevate_command|berror|bexecute|bexecute_assembly|bexit|bgetprivs|bgetsystem|bgetuid|bhashdump|binfo|binject|binjectsh|binput|bipconfig|bjobkill|bjobs|bjump|bkerberos_ccache_use|bkerberos_ticket_purge|bkerberos_ticket_use|bkeylogger|bkill|blink|blog|blog2|bloginuser|blogonpasswords|bls|bmimikatz|bmkdir|bmode|bmv|bnet|bnote|bpassthehash|bpause|bportscan|bpowerpick|bpowershell|bpowershell_import|bpowershell_import_clear|bppid|bps|bpsexec|bpsexec_command|bpsexec_psh|bpsinject|bpwd|breg_query|breg_queryv|bremote_exec|brev2self|brm|brportfwd|brportfwd_stop|brun|brunas|brunasadmin|brunu|bscreenshot|bsetenv|bshell|bshinject|bshspawn|bsleep|bsocks|bsocks_stop|bspawn|bspawnas|bspawnto|bspawnu|bssh|bssh_key|bstage|bsteal_token|bsudo|btask|btimestomp|bunlink|bupload|bupload_raw|bwdigest|bwinrm|bwmi)(?=[\\s(;,)]|$)"
        }
      ]
    },
    "builtin-beacon-info": {
      "comment": "beacon_* functions for querying beacon state",
      "patterns": [
        {
          "name": "support.function.beacon-info.cna",
          "match": "(?<![\\w&])&?(beacon_command_describe|beacon_command_detail|beacon_command_register|beacon_commands|beacon_data|beacon_elevator_describe|beacon_elevator_register|beacon_elevators|beacon_execute_job|beacon_exploit_describe|beacon_exploit_register|beacon_exploits|beacon_host_imported_script|beacon_host_script|beacon_ids|beacon_info|beacon_link|beacon_remote_exec_method_describe|beacon_remote_exec_method_register|beacon_remote_exec_methods|beacon_remote_exploit_arch|beacon_remote_exploit_describe|beacon_remote_exploit_register|beacon_remote_exploits|beacon_remove|beacon_stage_pipe|beacon_stage_tcp|beacons|ssh_command_describe|ssh_command_detail|ssh_command_register|ssh_commands)(?=[\\s(;,)]|$)"
        }
      ]
    },
    "builtin-aggressor-functions": {
      "comment": "Aggressor Script UI and management functions",
      "patterns": [
        {
          "name": "support.function.aggressor.cna",
          "match": "(?<![\\w&])&?(action|addTab|addVisualization|add_to_clipboard|alias_clear|applications|archives|artifact_general|artifact_payload|artifact_sign|artifact_stager|base64_decode|base64_encode|call|closeClient|colorPanel|credential_add|credentials|data_keys|data_query|dbutton_action|dbutton_help|dialog|dialog_description|dialog_show|dispatch_event|downloads|drow_beacon|drow_checkbox|drow_combobox|drow_exploits|drow_file|drow_interface|drow_krbtgt|drow_listener|drow_listener_stage|drow_mailserver|drow_site|drow_text|drow_text_big|dstamp|elog|encode|fireAlias|fireEvent|format_size|getAggressorClient|gunzip|gzip|highlight|host_delete|host_info|host_update|hosts|insert_component|insert_menu|iprange|keystrokes|licenseKey|listener_create_ext|listener_delete|listener_describe|listener_info|listener_pivot_create|listener_restart|listeners|listeners_local|listeners_stageless|localip|menubar|mynick|nextTab|openAboutDialog|openApplicationManager|openAutoRunDialog|openBeaconBrowser|openBeaconConsole|openBrowserPivotSetup|openBypassUACDialog|openCloneSiteDialog|openConnectDialog|openCovertVPNSetup|openCredentialManager|openDownloadBrowser|openElevateDialog|openEventLog|openFileBrowser|openGoldenTicketDialog|openHTMLApplicationDialog|openHostFileDialog|openInterfaceManager|openJavaSignedAppletDialog|openJavaSmartAppletDialog|openJumpDialog|openKeystrokeBrowser|openListenerManager|openMakeTokenDialog|openOfficeMacro|openOneLinerDialog|openOrActivate|openPayloadGeneratorDialog|openPayloadHelper|openPivotListenerSetup|openPortScanner|openPortScannerLocal|openPowerShellWebDialog|openPreferencesDialog|openProcessBrowser|openSOCKSBrowser|openSOCKSSetup|openScreenshotBrowser|openScriptConsole|openScriptManager|openScriptedWebDialog|openServiceBrowser|openSiteManager|openSpawnAsDialog|openSpearPhishDialog|openSystemInformationDialog|openSystemProfilerDialog|openTargetBrowser|openWebLog|openWindowsDropperDialog|openWindowsExecutableDialog|openWindowsExecutableStage|payload|pgraph|pivots|popup_clear|powershell_command|powershell_compress|pref_get|pref_get_list|pref_set|pref_set_list|previousTab|privmsg|prompt_confirm|prompt_directory_open|prompt_file_open|prompt_file_save|prompt_text|range|removeTab|resetData|say|sbrowser|screenshots|script_resource|separator|services|showVisualization|show_error|show_message|site_host|site_kill|sites|stager|stager_bind_pipe|stager_bind_tcp|str_chunk|str_decode|str_encode|str_xor|sync_download|targets|tbrowser|tokenToEmail|transform|transform_vbs|tstamp|url_open|users|vpn_interface_info|vpn_interfaces|vpn_tap_create|vpn_tap_delete)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.report.cna",
          "match": "(?<![\\w&])&?(agApplications|agC2info|agCredentials|agServices|agSessions|agTargets|agTokens|attack_describe|attack_detect|attack_mitigate|attack_name|attack_tactics|attack_url|bookmark|br|describe|h1|h2|h3|h4|kvtable|landscape|layout|list_unordered|nobreak|output|p|p_formatted|table|ts)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.pe-manipulation.cna",
          "match": "(?<![\\w&])&?(pe_insert_rich_header|pe_mask|pe_mask_section|pe_mask_string|pe_patch_code|pe_remove_rich_header|pe_set_compile_time_with_long|pe_set_compile_time_with_string|pe_set_export_name|pe_set_long|pe_set_short|pe_set_string|pe_set_stringz|pe_set_value_at|pe_stomp|pe_update_checksum|pedumo|setup_reflective_loader|extract_reflective_loader|bof_extract|bof_pack)(?=[\\s(;,)]|$)"
        }
      ]
    },
    "builtin-sleep-functions": {
      "comment": "Sleep language built-in functions",
      "patterns": [
        {
          "name": "support.function.sleep.array.cna",
          "match": "(?<![\\w&])&?(add|addAll|cast|clear|concat|copy|filter|flatten|map|pop|push|putAll|reduce|remove|removeAll|removeAt|retainAll|reverse|search|shift|size|sort|sorta|sortd|sortn|splice|sublist|sum)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.sleep.date.cna",
          "match": "(?<![\\w&])&?(formatDate|parseDate|ticks)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.sleep.file.cna",
          "match": "(?<![\\w&])&?(chdir|createNewFile|cwd|deleteFile|getFileName|getFileParent|getFileProper|lastModified|listRoots|lof|ls|mkdir|rename|setLastModified|setReadOnly)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.sleep.hash.cna",
          "match": "(?<![\\w&])&?(keys|ohash|ohasha|setMissPolicy|setRemovalPolicy|values)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.sleep.io.cna",
          "match": "(?<![\\w&])&?(allocate|available|bread|bwrite|closef|connect|exec|fork|getConsole|listen|mark|openf|print|printAll|printEOF|println|readAll|readAsObject|readb|readc|readln|readObject|reset|setEncoding|sizeof|skip|wait|writeAsObject|writeb|writeObject)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.sleep.math.cna",
          "match": "(?<![\\w&])&?(abs|acos|asin|atan|atan2|ceil|checksum|cos|degrees|digest|double|exp|floor|formatNumber|int|log|long|not|parseNumber|radians|rand|round|sin|sqrt|srand|tan|uint)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.sleep.string.cna",
          "match": "(?<![\\w&])&?(asc|byteAt|chr|charAt|find|indexOf|join|lc|left|lindexOf|matched|matches|mid|pack|replace|replaceAt|right|split|strlen|strrep|substr|tr|uc|unpack)(?=[\\s(;,)]|$)"
        },
        {
          "name": "support.function.sleep.core.cna",
          "match": "(?<![\\w&])&?(acquire|casti|checkError|compile_closure|debug|eval|exit|expr|function|getStackTrace|global|iff|include|inline|invoke|lambda|let|local|newInstance|popl|profile|pushl|release|scalar|semaphore|setf|setField|sleep|systemProperties|taint|typeOf|untaint|use|warn|watch)(?=[\\s(;,)]|$)"
        }
      ]
    },
    "builtin-hooks": {
      "comment": "Aggressor Script hook names (used with set)",
      "patterns": [
        {
          "name": "support.constant.hook.cna",
          "match": "\\b(APPLET_SHELLCODE_FORMAT|BEACON_RDLL_GENERATE|BEACON_RDLL_GENERATE_LOCAL|BEACON_SLEEP_MASK|EXECUTABLE_ARTIFACT_GENERATOR|HTMLAPP_EXE|HTMLAPP_POWERSHELL|POWERSHELL_COMMAND|POWERSHELL_COMPRESS|POWERSHELL_DOWNLOAD_CRADLE|PSEXEC_SERVICE|PYTHON_COMPRESS|RESOURCE_GENERATOR|RESOURCE_GENERATOR_VBS|SIGNED_APPLET_MAINCLASS|SIGNED_APPLET_RESOURCE|SMART_APPLET_MAINCLASS|SMART_APPLET_RESOURCE)\\b"
        }
      ]
    },
    "function-call": {
      "patterns": [
        {
          "name": "entity.name.function.call.cna",
          "match": "&[a-zA-Z_][a-zA-Z0-9_]*"
        },
        {
          "name": "entity.name.function.call.cna",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)(?=\\s*\\()"
        }
      ]
    },
    "variable": {
      "patterns": [
        {
          "name": "variable.other.special.cna",
          "match": "\\$[0-9]\\b",
          "comment": "Positional parameters $1, $2, etc."
        },
        {
          "name": "variable.other.scalar.cna",
          "match": "(\\$)[a-zA-Z_][a-zA-Z0-9_]*",
          "captures": {
            "1": { "name": "punctuation.definition.variable.cna" }
          }
        },
        {
          "name": "variable.other.array.cna",
          "match": "(@)[a-zA-Z_][a-zA-Z0-9_]*",
          "captures": {
            "1": { "name": "punctuation.definition.variable.cna" }
          }
        },
        {
          "name": "variable.other.hash.cna",
          "match": "(%)[a-zA-Z_][a-zA-Z0-9_]*",
          "captures": {
            "1": { "name": "punctuation.definition.variable.cna" }
          }
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.cna",
          "match": "\\s(eq|ne|lt|gt|le|ge|isin|iswm|hasmatch)\\s"
        },
        {
          "name": "keyword.operator.type.cna",
          "match": "\\s(-isarray|-ishash|-isfunction|-isletter|-isnumber|-isupper|-islower|-istrue)\\s"
        },
        {
          "name": "keyword.operator.logical.cna",
          "match": "(&&|\\|\\||!)"
        },
        {
          "name": "keyword.operator.arithmetic.cna",
          "match": "(\\+=|-=|\\*=|/=|%=|\\+|-|\\*|/|%)"
        },
        {
          "name": "keyword.operator.assignment.cna",
          "match": "(?<![=!<>])=(?![=>])"
        },
        {
          "name": "keyword.operator.range.cna",
          "match": "\\.\\."
        },
        {
          "name": "keyword.operator.hash.cna",
          "match": "=>"
        },
        {
          "name": "keyword.operator.string-repeat.cna",
          "match": "\\bx\\b"
        }
      ]
    }
  }
}
